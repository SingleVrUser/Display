<!-- Copyright (c) Microsoft Corporation and Contributors. -->
<!-- Licensed under the MIT License. -->

<Page
    x:Class="Display.ContentsPage.DatumList.FileListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Display.ContentsPage.DatumList"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:behaviors="using:CommunityToolkit.WinUI.UI.Behaviors"
    xmlns:converter="using:Display.Converter"
    xmlns:control="using:Display.Control"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:data="using:Data"
    mc:Ignorable="d">

    <Page.Resources>
        <Style TargetType="TextBlock" x:Key="TitleText">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Light"/>
        </Style>
        
        <Style TargetType="TextBlock" x:Key="ValueText">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <DataTemplate x:Key="FileListTemplate" x:DataType="data:FilesInfo">
            <Grid DoubleTapped="OpenFolder_Tapped">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="5*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Image Height="30" Width="30">
                        <Image.Source>
                            <SvgImageSource UriSource="{x:Bind IconPath}" RasterizePixelWidth="35" RasterizePixelHeight="30"/>
                        </Image.Source>
                    </Image>
                    
                    <TextBlock Grid.Column="1"
                                Text="{x:Bind Name}" 
                                Style="{StaticResource ValueText}"
                                Tapped="TextBlock_Tapped"
                                HorizontalAlignment="Left"/>
                </Grid>
                
                <TextBlock  Grid.Column="1"
                            Text="{x:Bind datum.te,Converter={StaticResource Int32ToDateTimeStrConverter}}"
                            Style="{StaticResource ValueText}"/>

                <TextBlock  Grid.Column="2"
                            Text="{x:Bind datum.s,Converter={StaticResource BytesToSizeStrConverter}}"
                            Style="{StaticResource ValueText}"/>
            </Grid>
        </DataTemplate>

        <converter:BytesToSizeStrConverter x:Key="BytesToSizeStrConverter" />
        <converter:Int32ToDateTimeStrConverter x:Key="Int32ToDateTimeStrConverter" />


    </Page.Resources>

    <Grid Loaded="Grid_loaded" RowSpacing="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <ProgressRing x:Name="ProgressRing" IsActive="False"/>

        <StackPanel Orientation="Horizontal" Margin="3" Spacing="3">
            <Button Content="播放" Click="PlayButton_Click"/>
            <Button Content="导入" IsEnabled="False"/>
            <Button Content="查重" IsEnabled="False"/>
            <Button Content="删除" IsEnabled="False"/>
        </StackPanel>

        <controls:MetadataControl Margin="10,0" Grid.Row="1" x:Name="metadataControl" Separator=" > "/>

        <Grid Grid.Row="2" BorderThickness="0,1,0,0" BorderBrush="{StaticResource CircleElevationBorderBrush}">
            <ListView
                x:Name="BaseExample"
                Grid.Row="1"
                Grid.ColumnSpan="4"
                ItemTemplate="{StaticResource FileListTemplate}"
                DragOver="Source_DragOver"
                DragItemsStarting="Source_DragItemsStarting"
                CanDragItems="True"
                SelectionMode="Multiple">
                
                <interactivity:Interaction.Behaviors>
                    <behaviors:QuickReturnHeaderBehavior />
                </interactivity:Interaction.Behaviors>
                
                <ListView.Header>
                    <Grid MinHeight="30" Background="White">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="5*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock
                                Style="{StaticResource TitleText}"
                                HorizontalAlignment="Left"
                                Margin="180,0"
                            Tapped="OrderBy_Tapped">
                                <Run>名称</Run>
                                <Run x:Name="Name_Run" FontFamily="Segoe Fluent Icons"></Run>
                        </TextBlock>

                        <TextBlock
                           Style="{StaticResource TitleText}"
                           Grid.Column="1"
                            Margin="25,0"
                            Tapped="OrderBy_Tapped">
                            <Run>修改时间</Run>
                            <Run x:Name="Time_Run" FontFamily="Segoe Fluent Icons" Text="&#xE015;"></Run>
                        </TextBlock>

                        <TextBlock
                           Style="{StaticResource TitleText}"
                           Grid.Column="2"
                            Margin="2,0"
                            Tapped="OrderBy_Tapped">
                            <Run>大小</Run>
                            <Run x:Name="Size_Run" FontFamily="Segoe Fluent Icons"></Run>
                        </TextBlock>
                    </Grid>
                </ListView.Header>
            </ListView>

        </Grid>

        <Button Grid.Row="3" RelativePanel.AlignRightWithPanel="True" IsEnabled="False" Visibility="Collapsed">
            <Button.Content>
                <SymbolIcon Symbol="Sort"/>
            </Button.Content>
            <Button.Flyout>
                <MenuFlyout Placement="Bottom">
                    <MenuFlyoutItem Text="名称">
                        <MenuFlyoutItem.Icon>
                            <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE185;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutItem Text="时间">
                        <MenuFlyoutItem.Icon>
                            <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xEC92;"/>
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutItem Text="文件大小">
                        <MenuFlyoutItem.Icon>
                            <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xEB05;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                </MenuFlyout>
            </Button.Flyout>
        </Button>

        <control:ShowCountControl Grid.Row="3"
                                Margin="2"
                                CurrentCount="{x:Bind filesInfos.Count,Mode=OneWay}"
                                AllCount="{x:Bind filesInfos.AllCount,Mode=OneWay}"
                                HorizontalAlignment="Right"
                                Clicked="ToTopButton_Click"/>
    
    </Grid>
</Page>
